ğŸ“‹ SYNTHÃˆSE EXHAUSTIVE AVANT CODAGE
ğŸ¯ OBJECTIF
CrÃ©er isbn_unified.sh qui fusionne TOUTES les fonctionnalitÃ©s de :

run.sh
add_book_minimal.sh
add_and_collect.sh
collect_api_data.sh
analyze_with_collect.sh
martingale.sh

ğŸ“ STRUCTURE DES FICHIERS
Fichier principal :

isbn_unified.sh (~800 lignes) : Menu, routing, logique principale

Fichiers Ã  crÃ©er :

apis/claude_ai.sh : API Claude pour descriptions
lib/export_checks.sh : VÃ©rifications d'exportabilitÃ©
lib/maintenance_tools.sh : Outils de maintenance

Fichiers Ã  mettre Ã  jour :

lib/enrichment.sh : +fonctions de collecte depuis collect_api_data.sh
lib/analyze_display.sh : +affichage mode notableau

Fichiers Ã  renommer en .bak :

Les 6 fichiers fusionnÃ©s

ğŸ”§ FONCTIONNALITÃ‰S PRINCIPALES

Modes de lancement :

Sans params â†’ Menu interactif
Avec ISBN â†’ Analyse directe
Avec options â†’ Actions spÃ©cifiques


Options disponibles :

-force : RÃ©analyse forcÃ©e
-notableau : Sans tableaux AVANT/APRÃˆS
-vendu ISBN : DÃ©crÃ©mente stock
-export [market] : Export marketplace
-n[X] : Limite nombre de livres
-s[X] : Pause X secondes
-groq : Utilise Groq au lieu de Claude
-noverbose[2] : Moins de dÃ©tails


Menu principal (10 options) :

Analyse complÃ¨te (AVANT/APRÃˆS)
Collecte rapide (sans tableaux)
Ajouter un nouveau livre
Marquer comme vendu
Rapport complet (ex-martingale)
Exporter vers marketplaces
CatÃ©gorisation IA double
GÃ©nÃ©rer rapport statistiques
Tester les APIs
Maintenance (sous-menu)



ğŸ“Š NOUVELLES FONCTIONNALITÃ‰S

Gestion du stock :

Nouvelle meta _stock_quantity
DÃ©crÃ©mentation avec -vendu
Mise Ã  jour _stock_status


Score d'exportabilitÃ© :

Calcul dynamique des points
Affichage "18/20 points"
Liste des donnÃ©es manquantes


Import images WordPress :

TÃ©lÃ©chargement et vÃ©rification
Import dans Media Library
Stockage URLs + attachment ID


Mode notableau :

Affichage compact
Description Claude visible
Stats finales (X/Y points)


Maintenance avancÃ©e :

Recalcul poids/dimensions
VÃ©rification images cassÃ©es
Export CSV inventaire
Nettoyage titres
Stats globales



ğŸ”„ WORKFLOW DE COLLECTE

VÃ©rification initiale :

ISBN existe ? â†’ Proposer analyse
DonnÃ©es complÃ¨tes ? â†’ Score et manques
Force ? â†’ Skip vÃ©rifications


Collecte APIs (ordre) :

Google Books â†’ ISBNdb â†’ Open Library
Si pas de description â†’ Claude (ou Groq si -groq)
Calculs automatiques (poids, dimensions)


Post-traitement :

Import images si trouvÃ©es
Calcul score exportabilitÃ©
Stockage mÃ©tadonnÃ©es
Correction bug publisher



âš¡ COMPORTEMENTS SPÃ‰CIAUX

Prix = 0 â†’ Toujours redemander
Stock par dÃ©faut = 1
Ã‰tat mapping â†’ 6 Ã©tats vers formats marketplace
Pause collecte â†’ Variable COLLECT_DELAY
Erreur Claude â†’ ArrÃªt complet (pas de fallback Groq)
Images â†’ VÃ©rifier existence + dimensions si possible

ğŸ›¡ï¸ SÃ‰CURITÃ‰

Utilisation systÃ©matique de safe_sql pour apostrophes
Validation ISBN avant traitement
VÃ©rification packages avant utilisation
Gestion erreurs MySQL propre
Logs dÃ©taillÃ©s en mode DEBUG

ğŸ“ ORDRE DE DÃ‰VELOPPEMENT

apis/claude_ai.sh (nouveau)
lib/export_checks.sh (nouveau)
lib/maintenance_tools.sh (nouveau)
lib/enrichment.sh (mise Ã  jour)
lib/analyze_display.sh (mise Ã  jour)
isbn_unified.sh (principal)


SYNTHÃˆSE FINALE COMPLÃˆTE AVEC -p[X]
ğŸ¯ NOUVELLE FONCTIONNALITÃ‰ -p[X] INTÃ‰GRÃ‰E
Comportement de -p[X] :

-p10 : Traite les 10 premiers livres incomplets (score < max)
Les livres restent dans la queue jusqu'Ã  Ãªtre complets
-force -p10 : Traite les 10 premiers TOUS (ignore le score)

Combinaisons valides :
bash./isbn_unified.sh -p10 -notableau    # 10 livres sans tableaux
./isbn_unified.sh -p10 -groq         # 10 livres avec Groq
./isbn_unified.sh -p10 -noverbose    # 10 livres silencieux
./isbn_unified.sh -p10 -s5           # 10 livres, pause 5s entre chaque
./isbn_unified.sh -force -p10        # Force les 10 premiers mÃªme si complets
ğŸ“Š TOUTES LES OPTIONS DU SCRIPT
bashğŸ“š ISBN UNIFIED - Gestionnaire complet
Usage: ./isbn_unified.sh [OPTIONS] [ISBN] [PRIX] [Ã‰TAT] [STOCK]

Options principales:
  -p[X]          Traiter X livres incomplets
  -force         Force la rÃ©analyse (ignore score)
  -notableau     Sans tableaux dÃ©taillÃ©s AVANT/APRÃˆS
  -vendu ISBN    DÃ©crÃ©menter stock d'un livre
  -export MARKET Exporter vers marketplace
  -n[X]          Limiter export Ã  X livres
  -s[X]          Pause X secondes entre livres
  -groq          Utiliser Groq au lieu de Claude
  -noverbose     Moins de dÃ©tails (niveau 1)
  -noverbose2    Minimum de dÃ©tails (niveau 2)

Ã‰tats: 1=Neuf Ã©tiq. 2=Neuf 3=TrÃ¨s bon 4=Bon 5=Correct 6=Passable
Marketplaces: amazon, rakuten, vinted, fnac, cdiscount, leboncoin, all
ğŸ”„ LOGIQUE DE SÃ‰LECTION POUR -p[X]
Sans -force :
sqlWHERE (pm_score.meta_value IS NULL OR pm_score.meta_value < MAX_SCORE)
ORDER BY p.ID ASC
LIMIT X
Avec -force :
sqlWHERE p.post_type = 'product' AND p.post_status = 'publish'
ORDER BY p.ID ASC  
LIMIT X
ğŸ“ RÃ‰SUMÃ‰ FINAL DES FONCTIONNALITÃ‰S

Traitement par lot (-p[X]) âœ…
Analyse avec tableaux AVANT/APRÃˆS âœ…
Mode rapide sans tableaux (-notableau) âœ…
Ajout de nouveaux livres âœ…
Gestion stock avec dÃ©crÃ©mentation (-vendu) âœ…
Export marketplace avec limite (-n[X]) âœ…
Rapport dÃ©taillÃ© (ex-martingale) âœ…
Score d'exportabilitÃ© avec dÃ©tails manquants âœ…
Import images WordPress âœ…
Maintenance avancÃ©e (5 sous-options) âœ…

ğŸš€ ORDRE DE CODAGE FINAL

apis/claude_ai.sh (150 lignes)
lib/export_checks.sh (300 lignes)
lib/maintenance_tools.sh (400 lignes)
lib/enrichment.sh (mise Ã  jour +200 lignes)
lib/analyze_display.sh (mise Ã  jour +100 lignes)
isbn_unified.sh (800-1000 lignes)
